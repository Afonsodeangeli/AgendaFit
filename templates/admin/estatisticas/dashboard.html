{% extends "base_privada.html" %}

{% block titulo %}Dashboard{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2 class="fw-bold" style="font-family: 'Montserrat', sans-serif; color: var(--fitness-blue);">
                <i class="bi bi-bar-chart-fill me-2 icon-blue"></i>Dashboard de Estatísticas
            </h2>
        </div>

        <!-- Cards de Acesso Rápido - Espelhando Menu -->
        <div class="row g-3 mb-4">
            <!-- ACADEMIA - Categorias -->
            <div class="col-md-6 col-lg-4 col-xl-2">
                <a href="/admin/categorias/listar" class="text-decoration-none">
                    <div class="card card-fitness h-100 text-center p-3 bg-body">
                        <div class="card-body d-flex flex-column align-items-center justify-content-center">
                            <i class="bi bi-tags icon-orange fs-1 mb-2"></i>
                            <h6 class="card-title fw-bold mb-1" style="color: var(--fitness-orange);">Categorias</h6>
                            <p class="text-body-secondary small mb-0">{{ total_categorias }} cadastradas</p>
                        </div>
                    </div>
                </a>
            </div>

            <!-- ACADEMIA - Atividades -->
            <div class="col-md-6 col-lg-4 col-xl-2">
                <a href="/admin/atividades/listar" class="text-decoration-none">
                    <div class="card card-fitness h-100 text-center p-3 bg-body">
                        <div class="card-body d-flex flex-column align-items-center justify-content-center">
                            <i class="bi bi-activity icon-green fs-1 mb-2"></i>
                            <h6 class="card-title fw-bold mb-1" style="color: var(--fitness-green);">Atividades</h6>
                            <p class="text-body-secondary small mb-0">{{ total_atividades }} cadastradas</p>
                        </div>
                    </div>
                </a>
            </div>

            <!-- ACADEMIA - Turmas -->
            <div class="col-md-6 col-lg-4 col-xl-2">
                <a href="/admin/turmas/listar" class="text-decoration-none">
                    <div class="card card-fitness h-100 text-center p-3 bg-body">
                        <div class="card-body d-flex flex-column align-items-center justify-content-center">
                            <i class="bi bi-calendar2-week icon-blue fs-1 mb-2"></i>
                            <h6 class="card-title fw-bold mb-1" style="color: var(--fitness-blue);">Turmas</h6>
                            <p class="text-body-secondary small mb-0">{{ total_turmas }} turmas</p>
                        </div>
                    </div>
                </a>
            </div>

            <!-- ACADEMIA - Matrículas -->
            <div class="col-md-6 col-lg-4 col-xl-2">
                <a href="/admin/matriculas/listar" class="text-decoration-none">
                    <div class="card card-fitness h-100 text-center p-3 bg-body">
                        <div class="card-body d-flex flex-column align-items-center justify-content-center">
                            <i class="bi bi-card-checklist icon-orange fs-1 mb-2"></i>
                            <h6 class="card-title fw-bold mb-1" style="color: var(--fitness-orange);">Matrículas</h6>
                            <p class="text-body-secondary small mb-0">{{ total_matriculas }} registros</p>
                        </div>
                    </div>
                </a>
            </div>

            <!-- ACADEMIA - Pagamentos -->
            <div class="col-md-6 col-lg-4 col-xl-2">
                <a href="/admin/pagamentos/listar" class="text-decoration-none">
                    <div class="card card-fitness h-100 text-center p-3 bg-body">
                        <div class="card-body d-flex flex-column align-items-center justify-content-center">
                            <i class="bi bi-cash-coin icon-green fs-1 mb-2"></i>
                            <h6 class="card-title fw-bold mb-1" style="color: var(--fitness-green);">Pagamentos</h6>
                            <p class="text-body-secondary small mb-0">Gerenciar</p>
                        </div>
                    </div>
                </a>
            </div>

            <!-- Chamados -->
            <div class="col-md-6 col-lg-4 col-xl-2">
                <a href="/admin/chamados/listar" class="text-decoration-none">
                    <div class="card card-fitness h-100 text-center p-3 bg-body">
                        <div class="card-body d-flex flex-column align-items-center justify-content-center">
                            <i class="bi bi-headset icon-blue fs-1 mb-2"></i>
                            <h6 class="card-title fw-bold mb-1" style="color: var(--fitness-blue);">Chamados</h6>
                            <p class="text-body-secondary small mb-0">Suporte</p>
                        </div>
                    </div>
                </a>
            </div>

            <!-- Usuários -->
            <div class="col-md-6 col-lg-4 col-xl-2">
                <a href="/admin/usuarios/listar" class="text-decoration-none">
                    <div class="card card-fitness h-100 text-center p-3 bg-body">
                        <div class="card-body d-flex flex-column align-items-center justify-content-center">
                            <i class="bi bi-people icon-orange fs-1 mb-2"></i>
                            <h6 class="card-title fw-bold mb-1" style="color: var(--fitness-orange);">Usuários</h6>
                            <p class="text-body-secondary small mb-0">Todos os perfis</p>
                        </div>
                    </div>
                </a>
            </div>

            <!-- SISTEMA - Configurações -->
            <div class="col-md-6 col-lg-4 col-xl-2">
                <a href="/admin/configuracoes" class="text-decoration-none">
                    <div class="card card-fitness h-100 text-center p-3 bg-body">
                        <div class="card-body d-flex flex-column align-items-center justify-content-center">
                            <i class="bi bi-sliders icon-green fs-1 mb-2"></i>
                            <h6 class="card-title fw-bold mb-1" style="color: var(--fitness-green);">Configurações</h6>
                            <p class="text-body-secondary small mb-0">Sistema</p>
                        </div>
                    </div>
                </a>
            </div>

            <!-- SISTEMA - Tema -->
            <div class="col-md-6 col-lg-4 col-xl-2">
                <a href="/admin/tema" class="text-decoration-none">
                    <div class="card card-fitness h-100 text-center p-3 bg-body">
                        <div class="card-body d-flex flex-column align-items-center justify-content-center">
                            <i class="bi bi-palette icon-blue fs-1 mb-2"></i>
                            <h6 class="card-title fw-bold mb-1" style="color: var(--fitness-blue);">Tema</h6>
                            <p class="text-body-secondary small mb-0">Personalizar</p>
                        </div>
                    </div>
                </a>
            </div>

            <!-- SISTEMA - Auditoria -->
            <div class="col-md-6 col-lg-4 col-xl-2">
                <a href="/admin/auditoria" class="text-decoration-none">
                    <div class="card card-fitness h-100 text-center p-3 bg-body">
                        <div class="card-body d-flex flex-column align-items-center justify-content-center">
                            <i class="bi bi-journal-text icon-orange fs-1 mb-2"></i>
                            <h6 class="card-title fw-bold mb-1" style="color: var(--fitness-orange);">Auditoria</h6>
                            <p class="text-body-secondary small mb-0">Histórico</p>
                        </div>
                    </div>
                </a>
            </div>

            <!-- SISTEMA - Backup -->
            <div class="col-md-6 col-lg-4 col-xl-2">
                <a href="/admin/backups/listar" class="text-decoration-none">
                    <div class="card card-fitness h-100 text-center p-3 bg-body">
                        <div class="card-body d-flex flex-column align-items-center justify-content-center">
                            <i class="bi bi-database icon-green fs-1 mb-2"></i>
                            <h6 class="card-title fw-bold mb-1" style="color: var(--fitness-green);">Backup</h6>
                            <p class="text-body-secondary small mb-0">Dados</p>
                        </div>
                    </div>
                </a>
            </div>
        </div>

        <!-- Cards de Resumo de Estatísticas -->
        <div class="row g-3 mb-4">
            <div class="col-md-4">
                <div class="card card-fitness h-100">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="card-subtitle mb-2 text-body-secondary fw-bold">Total de Alunos</h6>
                                <h2 class="card-title mb-0 fw-bold" style="color: var(--fitness-blue);">{{ total_alunos }}</h2>
                            </div>
                            <div>
                                <i class="bi bi-person-circle icon-blue" style="font-size: 2.5rem; opacity: 0.3;"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card card-fitness h-100">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="card-subtitle mb-2 text-body-secondary fw-bold">Total de Professores</h6>
                                <h2 class="card-title mb-0 fw-bold" style="color: var(--fitness-green);">{{ total_professores }}</h2>
                            </div>
                            <div>
                                <i class="bi bi-person-badge icon-green" style="font-size: 2.5rem; opacity: 0.3;"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card card-fitness h-100">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="card-subtitle mb-2 text-body-secondary fw-bold">Taxa de Ocupação</h6>
                                <h2 class="card-title mb-0 fw-bold" style="color: var(--fitness-orange);">
                                    {% if total_turmas > 0 %}
                                    {{ ((total_matriculas / (total_turmas * 30)) * 100)|int }}%
                                    {% else %}
                                    0%
                                    {% endif %}
                                </h2>
                            </div>
                            <div>
                                <i class="bi bi-percent icon-orange" style="font-size: 2.5rem; opacity: 0.3;"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Turmas Mais Populares -->
        <div class="row mb-4">
            <div class="col-lg-6 mb-4 mb-lg-0">
                <div class="card shadow-sm">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0"><i class="bi bi-trophy"></i> Top 5 Turmas (Mais Matriculadas)</h5>
                    </div>
                    <div class="card-body">
                        {% if top_turmas %}
                        <div class="list-group list-group-flush">
                            {% for item in top_turmas %}
                            <div class="list-group-item">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div class="flex-grow-1">
                                        <h6 class="mb-1">{{ item.turma.nome }}</h6>
                                        <small class="text-muted">
                                            {{ item.num_matriculas }} / {{ item.turma.vagas }} alunos
                                            ({{ item.percentual_ocupacao }}% ocupação)
                                        </small>
                                    </div>
                                    <div>
                                        <span class="badge bg-primary rounded-pill">{{ item.num_matriculas }}</span>
                                    </div>
                                </div>
                                <div class="progress mt-2" style="height: 8px;">
                                    <div class="progress-bar bg-primary" role="progressbar"
                                         data-percent="{{ item.percentual_ocupacao }}"
                                         aria-valuenow="{{ item.percentual_ocupacao }}"
                                         aria-valuemin="0" aria-valuemax="100"></div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        {% else %}
                        <p class="text-muted mb-0">Nenhuma turma cadastrada.</p>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Atividades Mais Populares -->
            <div class="col-lg-6">
                <div class="card shadow-sm">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0"><i class="bi bi-fire"></i> Top 5 Atividades (Mais Alunos)</h5>
                    </div>
                    <div class="card-body">
                        {% if top_atividades %}
                        <div class="list-group list-group-flush">
                            {% for item in top_atividades %}
                            <div class="list-group-item">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h6 class="mb-1">{{ item.atividade.nome }}</h6>
                                        <small class="text-muted">
                                            {{ item.num_turmas }} turma(s) | {{ item.num_alunos }} aluno(s)
                                        </small>
                                    </div>
                                    <div>
                                        <span class="badge bg-success rounded-pill">{{ item.num_alunos }}</span>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        {% else %}
                        <p class="text-muted mb-0">Nenhuma atividade cadastrada.</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Professores e Cargas -->
        <div class="row">
            <div class="col-12">
                <div class="card shadow-sm">
                    <div class="card-header bg-info text-white">
                        <h5 class="mb-0"><i class="bi bi-person-workspace"></i> Professores e Cargas Horárias</h5>
                    </div>
                    <div class="card-body">
                        {% if professores_com_turmas %}
                        <div class="table-responsive">
                            <table class="table table-hover mb-0">
                                <thead>
                                    <tr>
                                        <th>Professor</th>
                                        <th class="text-center">Turmas</th>
                                        <th class="text-center">Total de Alunos</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for item in professores_com_turmas %}
                                    <tr>
                                        <td>
                                            <strong>{{ item.professor.nome }}</strong>
                                            <br>
                                            <small class="text-muted">{{ item.professor.email }}</small>
                                        </td>
                                        <td class="text-center">
                                            <span class="badge bg-info">{{ item.num_turmas }}</span>
                                        </td>
                                        <td class="text-center">
                                            <span class="badge bg-primary">{{ item.num_alunos }}</span>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        {% else %}
                        <p class="text-muted mb-0">Nenhum professor cadastrado.</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Apply percentual widths to progress bars using data-percent to avoid inline CSS parse issues
    document.addEventListener('DOMContentLoaded', function () {
        document.querySelectorAll('.progress-bar[data-percent]').forEach(function (el) {
            var pct = el.getAttribute('data-percent') || '0';
            // ensure numeric and clamp 0-100
            var n = Math.max(0, Math.min(100, Number(pct) || 0));
            el.style.width = n + '%';
            el.setAttribute('aria-valuenow', String(n));
        });
    });
</script>
{% endblock %}
